// rtsp-server.js
const express = require('express');
const expressWs = require('express-ws');
const { proxy } = require('rtsp-relay')(express());

const app = express();
expressWs(app);

// âœ… RTSP URL Ø¨Ø§ Ø±Ù…Ø² encoded
const CAMERA_URL = 'rtsp://admin:Admin%40123@192.168.10.10:554';

// WebSocket Ø¨Ø±Ø§ÛŒ Ù¾Ø®Ø´ ÙˆÛŒØ¯ÛŒÙˆ
app.ws('/ws/stream/main', proxy({ url: CAMERA_URL }));

// Ù…Ø³ÛŒØ± ØªØ³Øª Ø§ØªØµØ§Ù„ WebSocket (Ù†Ù‡ RTSP)
app.ws('/ws/test', (ws, req) => {
  ws.send('âœ… WebSocket Server OK');
  ws.on('message', msg => ws.send(`Echo: ${msg}`));
});

const PORT = 9000;
app.listen(PORT, () => {
  console.log(`ðŸŽ¥ RTSP relay running on: ws://localhost:${PORT}/ws/stream/main`);
});
